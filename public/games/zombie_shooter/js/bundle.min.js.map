{"version":3,"names":[],"mappings":"","sources":["bundle.min.js"],"sourcesContent":["!function o(a,c,s){function u(t,e){if(!c[t]){if(!a[t]){var n=\"function\"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var i=new Error(\"Cannot find module '\"+t+\"'\");throw i.code=\"MODULE_NOT_FOUND\",i}var r=c[t]={exports:{}};a[t][0].call(r.exports,function(e){return u(a[t][1][e]||e)},r,r.exports,o,a,c,s)}return c[t].exports}for(var l=\"function\"==typeof require&&require,e=0;e<s.length;e++)u(s[e]);return u}({1:[function(e,t,n){\"use strict\";Object.defineProperty(n,\"__esModule\",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,e),this.collidingRecord=[],this.collidingDelay=1e3}return i(e,[{key:\"CircleRectColliding\",value:function(e,t){if(this.collidingRecord[e]&&this.collidingRecord[e].with===t&&(new Date).getTime()<this.collidingRecord[e].time.getTime()+this.collidingDelay)return!1;var n=Math.abs(e.x-t.x-t.w/2),i=Math.abs(e.y-t.y-t.h/2);if(n>t.w/2+e.r)return!1;if(i>t.h/2+e.r)return!1;if(n<=t.w/2)return!0;if(i<=t.h/2)return!0;var r=n-t.w/2,o=i-t.h/2,a=r*r+o*o<=e.r*e.r;return a&&(this.collidingRecord[e]={with:t,time:new Date}),a}},{key:\"RectRectColliding\",value:function(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.height+e.y>t.y}},{key:\"RectPointColliding\",value:function(e,t){return e.x<=t.x&&e.x+e.width>=t.x&&e.y<=t.y&&e.height+e.y>=t.y}}]),e}();n.default=r},{}],2:[function(e,t,n){\"use strict\";var h=s(e(\"./GameObject/Item\")),i=s(e(\"./GameObject/Thomas\")),f=s(e(\"./GameObject/Zombie\")),r=s(e(\"./GameObject/Gun\")),o=s(e(\"./Collision\")),a=s(e(\"./ScrollingBackground\")),c=s(e(\"./Score\"));function s(e){return e&&e.__esModule?e:{default:e}}var d={Resource:{},difficulty:10},p=new o.default;d.Intro={level:1,create:function(){this.app.scrollingBackground=new a.default(this.app.images.background),this.app.scrollingBackground.init(this.app.width,this.app.height),this.addButton={text:\"＋\",x:this.app.center.x+200,y:this.app.center.y,width:40,height:40,background_color:\"#eee\"},this.minusButton={text:\"－\",x:this.app.center.x-200,y:this.app.center.y,width:40,height:40,background_color:\"#eee\"},this.startButton={text:\"Start\",x:this.app.center.x,y:this.app.center.y+200,width:80,height:40,background_color:\"#eee\"}},enter:function(){},step:function(e){},render:function(e){var t=this.addButton,n=this.minusButton,i=this.startButton;this.app.layer.clear(\"#000\"),this.app.scrollingBackground.render(this.app),this.app.layer.font(\"40px Georgia\").fillText(\"Level: \"+this.level,this.app.center.x-30,this.app.center.y).fillStyle(t.height+\"px #abc\").textWithBackground(t.text,t.x,t.y,t.background_color).fillStyle(n.height+\"px #abc\").textWithBackground(n.text,n.x,n.y,n.background_color).fillStyle(i.height+\"px #abc\").textWithBackground(i.text,i.x,i.y,i.background_color)},mousedown:function(e){p.RectPointColliding(this.addButton,e)&&this.level++,p.RectPointColliding(this.minusButton,e)&&this.level--,10<this.level&&(this.level=10),this.level<1&&(this.level=1),p.RectPointColliding(this.startButton,e)&&(d.difficulty=this.level,this.app.setState(d.Game))}},d.Game={create:function(){d.levelData=new u(this.app.data.levels[d.difficulty])},enter:function(){var e=Math.max(this.app.width,this.app.height);this.app.scrollingBackground=new a.default(this.app.images.background),this.app.scrollingBackground.init(this.app.width,this.app.height),this.app.thomas=new i.default({speed:128,x:this.app.center.x,y:this.app.center.y,hp:10,defence:1});var t=new r.default({maxRadius:e,colddown:d.levelData.gunColddown});this.app.thomas.takeWeapon(t),d.Resource=this.app.music.play(\"music\",!0),d.enemies=[],d.bullets=[],d.items=[],d.score=new c.default},step:function(t){var e=Math.max(this.app.width,this.app.height),n=this.app.thomas,i=this.app.scrollingBackground.move(n.speed*t),r=d.enemies;if(Math.random()<d.levelData.monsterSpawnRate){var o=d.levelData.monsterSpawnRadiusMin,a=Math.random()*(e-o)+o,c=Math.floor(360*Math.random()),s=new f.default({speed:d.levelData.monsterSpeed,x:Math.cos(c)*a,y:Math.sin(c)*a,directRadians:-c});r.push(s)}r.forEach(function(e){e.faceTo(n.x,n.y),e.run(t),e.x-=i[0],e.y-=i[1],p.RectRectColliding(e,n)&&(console.log(\"collission\"),n.getDamage(e.damage*t)||(this.app.music.stop(d.Resource),this.app.setState(d.Game)))}),n.attack(r,t);var u=d.items;if(u.length<10){var l=new h.default({x:Math.random()*this.app.width,y:Math.random()*this.app.height,type:h.default.gunColddown,value:-.01});u.push(l)}u.forEach(function(e){e.x-=i[0],e.y-=i[1],p.RectRectColliding(e,n)&&(console.log(\"get item\"),n.getItem(e),u.splice(u.indexOf(e),1))})},render:function(e){var t=this.app,n=this.app.thomas;t.layer.clear(\"#000\"),t.scrollingBackground.render(t),t.layer.font(\"40px Georgia\").fillText(\"Current: \"+d.score.getScore(),t.width-300,160).font(\"40px Green\").fillText(\"High: \"+d.score.getHighScore(),t.width-300,80).fillStyle(\"#000\").fillRect(20,20,300,30).fillStyle(\"#F00\").fillRect(20,20,n.hp/n.hpMax*300,30),t.thomas.render(t.layer),d.enemies.forEach(function(e){e.render(t)}),d.items.forEach(function(e){e.render(t.layer)})},keydown:function(e){var t=0;switch(e.key){case\"a\":t|=8;break;case\"d\":t|=4;break;case\"w\":t|=2;break;case\"s\":t|=1}this.app.scrollingBackground.faceTo(t)},keyup:function(e){var t=15;switch(e.key){case\"a\":t&=7;break;case\"d\":t&=11;break;case\"w\":t&=13;break;case\"s\":t&=14}this.app.scrollingBackground.faceCancel(t)},mousemove:function(e){this.app.thomas.faceTo(e.x,e.y)}};var u=function(n){return new Proxy(n,{get:function(e,t){return n[t]}})}},{\"./Collision\":1,\"./GameObject/Gun\":5,\"./GameObject/Item\":6,\"./GameObject/Thomas\":7,\"./GameObject/Zombie\":8,\"./Score\":9,\"./ScrollingBackground\":10}],3:[function(e,t,n){\"use strict\";Object.defineProperty(n,\"__esModule\",{value:!0});var r=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var i=function(){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,i);var t=Object.assign({x:0,y:0,width:32,height:32,color:\"#e2543e\",speed:256,directRadians:0,hp:1,damage:0,defence:0},e);for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])}return r(i,[{key:\"faceTo\",value:function(e,t){this.directRadians=Math.atan2(t-this.y,e-this.x)}},{key:\"run\",value:function(e){this.x+=Math.cos(this.directRadians)*this.speed*e,this.y+=Math.sin(this.directRadians)*this.speed*e}},{key:\"getDamage\",value:function(e){return this.hp-=e-this.defence,0<this.hp}},{key:\"render\",value:function(e){e.fillStyle(this.color).fillRect(this.x,this.y,this.width,this.height)}}]),i}();n.default=i},{}],4:[function(e,t,n){\"use strict\";Object.defineProperty(n,\"__esModule\",{value:!0});var i,r=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),o=e(\"./Ball\"),a=(i=o)&&i.__esModule?i:{default:i};var c=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,n);var t=Object.assign({x:0,y:0,width:10,height:10,color:\"#ff0000\",speed:1024,directRadians:0,damage:1,hp:1},e);return function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t))}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,a.default),r(n,[{key:\"render\",value:function(e){e.fillStyle(this.color).fillRect(this.x,this.y,this.width,this.height)}}]),n}();n.default=c},{\"./Ball\":3}],5:[function(e,t,n){\"use strict\";Object.defineProperty(n,\"__esModule\",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),r=o(e(\"../Collision\")),a=o(e(\"./Bullet\"));function o(e){return e&&e.__esModule?e:{default:e}}var c=new r.default,s=function(){function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,r);var t={maxRadius:0,colddown:0,toRadians:Math.asin(-1)},n=Object.assign(t,e);for(var i in n)n.hasOwnProperty(i)&&(this[i]=n[i]);this.bullets=[],this.nextshoot=0}return i(r,[{key:\"faceTo\",value:function(e){this.toRadians=e}},{key:\"attack\",value:function(e,t,n){if(!(0<this.nextshoot)){var i=this.bullets,r=new a.default({x:e,y:t,directRadians:this.toRadians});i.push(r);for(var o=i.length-1;0<=o;){((r=i[o]).x>this.maxRadius||r.y>this.maxRadius)&&i.splice(o,1),o-=1}return this.nextshoot=this.colddown,r}this.nextshoot-=n}},{key:\"step\",value:function(n,e){var i=this.bullets;i.forEach(function(t){t.run(e),n.forEach(function(e){c.RectRectColliding(t,e)&&(console.log(\"hit monster\"),ENGINE.score.add(ENGINE.levelData.scorePreHit),ENGINE.score.save(),t.getDamage(e.defence)||i.splice(i.indexOf(t),1),e.getDamage(t.damage)||n.splice(n.indexOf(e),1))})})}},{key:\"render\",value:function(t){this.bullets.forEach(function(e){e.render(t)})}},{key:\"upgrade\",value:function(e,t,n){n?this[e]*=t:this[e]+=t}}]),r}();n.default=s},{\"../Collision\":1,\"./Bullet\":4}],6:[function(e,t,n){\"use strict\";Object.defineProperty(n,\"__esModule\",{value:!0});var i,r=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),o=e(\"./Ball\"),a=(i=o)&&i.__esModule?i:{default:i};var c=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t),e.speed=0,e.color=\"#000\",function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),r(t,null,[{key:\"gunColddown\",get:function(){return\"gunColddown\"}}]),t}();n.default=c},{\"./Ball\":3}],7:[function(e,t,n){\"use strict\";Object.defineProperty(n,\"__esModule\",{value:!0});var i,r=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),o=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if(\"value\"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},a=e(\"./Ball\"),c=(i=a)&&i.__esModule?i:{default:i};var s=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.hpMax=t.hp,t}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,c.default),r(n,[{key:\"takeWeapon\",value:function(e){this.weapon=e}},{key:\"attack\",value:function(e,t){this.weapon&&(this.weapon.attack(this.x,this.y,t),this.weapon.step(e,t))}},{key:\"render\",value:function(e){o(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),\"render\",this).call(this,e),this.weapon.render(e)}},{key:\"faceTo\",value:function(e,t){o(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),\"faceTo\",this).call(this,e,t),this.weapon.faceTo(this.directRadians)}},{key:\"getItem\",value:function(e){switch(e.type){case Item.gunColddown:this.weapon.upgrade(\"colddown\",e.value)}}}]),n}();n.default=s},{\"./Ball\":3}],8:[function(e,t,n){\"use strict\";Object.defineProperty(n,\"__esModule\",{value:!0});var i,r=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),o=e(\"./Ball\"),a=(i=o)&&i.__esModule?i:{default:i};var c=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,i);var t=Object.assign({x:0,y:0,width:128,height:128,image:\"zombie\",speed:256,directRadians:0,hp:1,damage:1,defence:0},e),n=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return n.speed*=.8*Math.random()+.2,n}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,a.default),r(i,[{key:\"faceTo\",value:function(e,t){this.directRadians=Math.atan2(t-this.y,e-this.x)}},{key:\"run\",value:function(e){this.x+=Math.cos(this.directRadians)*this.speed*e,this.y+=Math.sin(this.directRadians)*this.speed*e}},{key:\"render\",value:function(e){e.layer.drawImage(e.images[this.image],this.x,this.y,this.width,this.height)}}]),i}();n.default=c},{\"./Ball\":3}],9:[function(e,t,n){\"use strict\";Object.defineProperty(n,\"__esModule\",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,e),this.scoreCurrent=0,this.scoreMax=0,this.highscore=localStorage.getItem(\"highscore\")||0}return i(e,[{key:\"save\",value:function(){this.scoreCurrent>this.highscore&&(this.highscore=this.scoreCurrent,localStorage.setItem(\"highscore\",this.highscore))}},{key:\"clear\",value:function(){this.scoreCurrent=0,this.scoreMax=0}},{key:\"add\",value:function(e){this.scoreCurrent+=e,this.scoreMax=Math.max(this.scoreMax,this.scoreCurrent)}},{key:\"newScore\",value:function(){return this.scoreCurrent===this.scoreMax}},{key:\"getHighScore\",value:function(){return Number(this.highscore).toFixed(2)}},{key:\"getScore\",value:function(){return Number(this.scoreCurrent).toFixed(2)}}]),e}();n.default=r},{}],10:[function(e,t,n){\"use strict\";Object.defineProperty(n,\"__esModule\",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var r=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t),this.backgrounds=[],this.bw=e.width,this.bh=e.height,this.image=e,this.layer={},this.directRadians=Math.asin(-1),this.faceDirectBits=0,this.dontMove=!0}return i(t,[{key:\"move\",value:function(e){if(this.dontMove)return[0,0];var t=Math.cos(this.directRadians)*e,n=Math.sin(this.directRadians)*e,i=this.layer.w,r=this.layer.h,o=Math.ceil(i/this.bw)+1,a=Math.ceil(r/this.bh)+1;return this.backgrounds.forEach(function(e){e[0]-=t,e[1]-=n,e[0]<-this.bw&&(e[0]+=(o+1)*this.bw),e[0]>i&&(e[0]-=(o+1)*this.bw),e[1]<-this.bh&&(e[1]+=(a+1)*this.bh),e[1]>r&&(e[1]-=(a+1)*this.bh)}),[t,n]}},{key:\"init\",value:function(e,t){this.layer={w:e,h:t};for(var n=Math.ceil(e/this.bw)+1,i=Math.ceil(t/this.bh)+1,r=-1;r<=n;r++)for(var o=-1;o<=i;o++)this.backgrounds.push([r*this.bw,o*this.bh])}},{key:\"_turn\",value:function(){var e=0,t=0;e-=this.faceDirectBits>>3&1,e+=this.faceDirectBits>>2&1,t-=this.faceDirectBits>>1&1,t+=this.faceDirectBits>>0&1,this.directRadians=Math.atan2(t,e),this.dontMove=0===e&&0===t}},{key:\"faceTo\",value:function(e){this.faceDirectBits|=e,this._turn()}},{key:\"faceCancel\",value:function(e){this.faceDirectBits&=e,this._turn()}},{key:\"render\",value:function(t){this.backgrounds.forEach(function(e){t.layer.drawImage(this.image,e[0],e[1])})}}]),t}();n.default=r},{}],11:[function(e,t,n){\"use strict\";var i,r=e(\"./Engine\"),o=(i=r)&&i.__esModule?i:{default:i};new PLAYGROUND.Application({paths:{sounds:\"/sounds/\",rewriteURL:{background:\"/images/background.png\"}},create:function(){this.loadSounds(\"music\"),this.loadImage([\"<background>\",\"zombie\"]),this.loadData(\"levels\")},ready:function(){this.setState(o.default.Intro)},mousedown:function(e){},scale:.5})},{\"./Engine\":2}]},{},[11]);"],"file":"bundle.min.js"}